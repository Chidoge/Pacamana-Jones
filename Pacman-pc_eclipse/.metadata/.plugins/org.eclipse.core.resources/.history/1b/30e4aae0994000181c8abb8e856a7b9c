package group23.pacman.view;

import group23.pacman.MainApp;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.input.KeyCode;
import javafx.scene.input.KeyEvent;

public class ResultsController {
	
	private MainApp mainApp;
	
	/* FXML */
	@FXML
	private ImageView background;
	
	
	
	@FXML
	private ImageView lives_remaining;
	@FXML
	private ImageView time_digit1;
	@FXML
	private ImageView time_digit2;
	@FXML
	private ImageView time_digit3;
	@FXML
	private ImageView score_digit1;
	@FXML
	private ImageView score_digit2;
	@FXML
	private ImageView score_digit3;
	@FXML
	private ImageView score_digit4;
	@FXML
	private ImageView total_digit1;
	
	
	
	
	
	/* Show these variables to the screen */
	private int time;
	private int lives;
	private int score;
	private int totalScore;
	
	
	/* Constructor */
	public ResultsController() {
		
	}
	
	
	public void addKeyListener() {
		
		mainApp.getScene().setOnKeyPressed(new EventHandler<KeyEvent> (){
	    	@Override
	    	public void handle(KeyEvent event) {
		    	if (event.getCode() == KeyCode.ESCAPE) {
		    		mainApp.showWelcomeScreen();
		    	}
		    	else if (event.getCode() == KeyCode.ENTER) {
		    		mainApp.showLevelSelect();
		    	}
	    	}
	    });
	}
	
	
	public void addParameters(int time,int lives,int score) {
		
		this.time = time;
		System.out.println(lives);
		this.lives = lives;
		this.score = score;
		
		this.totalScore = (time * 10) + (lives * 150) + score;
		
	}
	
	
	public void showScore() {
		
		lives_remaining.setImage(new Image(getDigit((char) (lives + 48))));
		
		String timeString = Integer.toString(this.time);
		
		if (timeString.length() == 3) {
			time_digit1.setImage(new Image(getDigit(timeString.charAt(0))));
			time_digit2.setImage(new Image(getDigit(timeString.charAt(1))));
			time_digit3.setImage(new Image(getDigit(timeString.charAt(2))));
		}
		else if (timeString.length() == 2) {
			time_digit2.setImage(new Image(getDigit(timeString.charAt(0))));
			time_digit3.setImage(new Image(getDigit(timeString.charAt(1))));
		}
		else if (timeString.length() == 2) {
			time_digit3.setImage(new Image(getDigit(timeString.charAt(0))));
		}
		
		/* Score showing */
		String scoreString = Integer.toString(this.score);
		if (score > 1000) {
			score_digit1.setImage(new Image(getDigit(scoreString.charAt(0))));
			score_digit2.setImage(new Image(getDigit(scoreString.charAt(1))));
			score_digit3.setImage(new Image(getDigit(scoreString.charAt(2))));
			score_digit4.setImage(new Image(getDigit(scoreString.charAt(3))));
		}
		else if (score > 100) {
			score_digit1.setImage(new Image(getDigit(scoreString.charAt(0))));
			score_digit2.setImage(new Image(getDigit(scoreString.charAt(1))));
			score_digit3.setImage(new Image(getDigit(scoreString.charAt(2))));
		}
		else if (score > 10) {
			score_digit1.setImage(new Image(getDigit(scoreString.charAt(0))));
			score_digit2.setImage(new Image(getDigit(scoreString.charAt(1))));
		}
		else {
			score_digit1.setImage(new Image(getDigit(scoreString.charAt(0))));

		}
		
		/* Show total score */
		String totalScoreString = Integer.toString(this.totalScore);
		if (totalScore > 1000) {
			total_digit1.setImage(new Image(getDigit(totalScoreString.charAt(0))));
			total_digit2.setImage(new Image(getDigit(totalScoreString.charAt(1))));
			total_digit3.setImage(new Image(getDigit(totalScoreString.charAt(2))));
			total_digit4.setImage(new Image(getDigit(totalScoreString.charAt(3))));
		}
		else if (totalScore > 100) {
			total_digit1.setImage(new Image(getDigit(totalScoreString.charAt(0))));
			total_digit2.setImage(new Image(getDigit(totalScoreString.charAt(1))));
			total_digit3.setImage(new Image(getDigit(totalScoreString.charAt(2))));
		}
		else if (totalScore > 10) {
			total_digit1.setImage(new Image(getDigit(totalScoreString.charAt(0))));
			total_digit2.setImage(new Image(getDigit(totalScoreString.charAt(1))));
		}
		else {
			total_digit1.setImage(new Image(getDigit(totalScoreString.charAt(0))));

		}
		
		
	}
	
	
	@FXML
	private void initialize() {
		
		background.setImage(new Image("bg/background-results.png"));
	}
	
	
	/* Helper function to break score digits down (to more easily show in UI) */
	private String getDigit(char digit){

        switch (digit){
            case '0' :
                return "assets/numbers/0.png";
            case '1' :
                return "assets/numbers/1.png";
            case '2' :
                return "assets/numbers/2.png";
            case '3' :
                return "assets/numbers/3.png";
            case '4' :
                return "assets/numbers/4.png";
            case '5' :
                return "assets/numbers/5.png";
            case '6' :
                return "assets/numbers/6.png";
            case '7' :
                return "assets/numbers/7.png";
            case '8' :
                return "assets/numbers/8.png";
            case '9' :
                return "assets/numbers/9.png";
            default :
                return "assets/numbers/0.png";
        }
    }
	
	/* Public setter to reference main app */
	public void setMainApp(MainApp mainApp) {
		
		this.mainApp = mainApp;
	}
}
